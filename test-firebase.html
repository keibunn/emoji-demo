<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase æ’è¡Œæ¦œæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        #leaderboard {
            margin-top: 20px;
        }
        .rank-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¥ Firebase æ’è¡Œæ¦œæµ‹è¯•</h1>
        
        <div id="status" class="status info">
            åˆå§‹åŒ–ä¸­...
        </div>
        
        <div>
            <h3>ğŸ§ª æµ‹è¯•åŠŸèƒ½</h3>
            <button onclick="testSubmitScore()">æäº¤æµ‹è¯•åˆ†æ•°</button>
            <button onclick="testMultipleScores()">æµ‹è¯•å¤šæ¬¡æäº¤ï¼ˆéªŒè¯å»é‡ï¼‰</button>
            <button onclick="loadLeaderboard()">åŠ è½½æ’è¡Œæ¦œ</button>
            <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        </div>
        
        <div>
            <h3>âš™ï¸ ç©å®¶è®¾ç½®</h3>
            <input type="text" id="playerName" placeholder="è¾“å…¥è‡ªå®šä¹‰æ˜µç§°" style="padding: 8px; margin-right: 10px;">
            <button onclick="setCustomName()">è®¾ç½®æ˜µç§°</button>
            <div id="currentPlayer" style="margin-top: 10px;"></div>
        </div>
        
        <div id="leaderboard">
            <h3>ğŸ† æ’è¡Œæ¦œ</h3>
            <div id="leaderboardContent">ç‚¹å‡»"åŠ è½½æ’è¡Œæ¦œ"æŸ¥çœ‹æ•°æ®</div>
        </div>
        
        <div id="results" style="margin-top: 20px;">
            <h3>ğŸ“‹ æµ‹è¯•ç»“æœ</h3>
            <div id="resultContent"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <!-- Firebase é…ç½® -->
    <script src="scripts/firebase-config.js"></script>
    <script src="scripts/leaderboard.js"></script>
    
    <script>
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }
        
        function addResult(message) {
            const resultEl = document.getElementById('resultContent');
            const time = new Date().toLocaleTimeString();
            resultEl.innerHTML += `<div>[${time}] ${message}</div>`;
        }
        
        function clearResults() {
            document.getElementById('resultContent').innerHTML = '';
        }
        
        // æ£€æŸ¥Firebaseåˆå§‹åŒ–çŠ¶æ€
        setTimeout(() => {
            if (window.firebaseDatabase && window.leaderboard) {
                updateStatus('Firebase åˆå§‹åŒ–æˆåŠŸï¼å¯ä»¥å¼€å§‹æµ‹è¯•', 'success');
                showCurrentPlayer();
            } else {
                updateStatus('Firebase åˆå§‹åŒ–å¤±è´¥ï¼è¯·æ£€æŸ¥é…ç½®', 'error');
            }
        }, 1000);
        
        function showCurrentPlayer() {
            if (window.leaderboard) {
                const playerId = window.leaderboard.generatePlayerId();
                const playerName = window.leaderboard.getPlayerName();
                document.getElementById('currentPlayer').innerHTML = 
                    `<strong>å½“å‰ç©å®¶:</strong> ${playerName} (ID: ${playerId.substring(0, 8)}...)`;
            }
        }
        
        async function testSubmitScore() {
            if (!window.leaderboard) {
                addResult('âŒ æ’è¡Œæ¦œåŠŸèƒ½æœªåˆå§‹åŒ–');
                return;
            }
            
            const randomScore = Math.floor(Math.random() * 1000) + 100;
            addResult(`ğŸ¯ æ­£åœ¨æäº¤æµ‹è¯•åˆ†æ•°: ${randomScore}`);
            
            try {
                const success = await window.leaderboard.submitScore(randomScore, 1);
                if (success) {
                    addResult(`âœ… åˆ†æ•°æäº¤æˆåŠŸï¼åˆ†æ•°: ${randomScore}`);
                    updateStatus('åˆ†æ•°æäº¤æˆåŠŸï¼', 'success');
                } else {
                    addResult('âŒ åˆ†æ•°æäº¤å¤±è´¥');
                    updateStatus('åˆ†æ•°æäº¤å¤±è´¥', 'error');
                }
            } catch (error) {
                addResult(`âŒ æäº¤é”™è¯¯: ${error.message}`);
                updateStatus('æäº¤å‡ºç°é”™è¯¯', 'error');
            }
        }

        async function testMultipleScores() {
            if (!window.leaderboard) {
                addResult('âŒ æ’è¡Œæ¦œåŠŸèƒ½æœªåˆå§‹åŒ–');
                return;
            }
            
            addResult('ğŸ§ª å¼€å§‹æµ‹è¯•å¤šæ¬¡æäº¤ï¼ˆéªŒè¯å»é‡é€»è¾‘ï¼‰...');
            
            const testScores = [150, 200, 175, 250, 180]; // æ¨¡æ‹Ÿå¤šæ¬¡æ¸¸æˆåˆ†æ•°
            
            try {
                for (let i = 0; i < testScores.length; i++) {
                    const score = testScores[i];
                    addResult(`ğŸ“¤ æäº¤ç¬¬${i+1}æ¬¡åˆ†æ•°: ${score}`);
                    
                    const success = await window.leaderboard.submitScore(score, 1);
                    if (success) {
                        addResult(`âœ… ç¬¬${i+1}æ¬¡æäº¤æˆåŠŸ`);
                    } else {
                        addResult(`âŒ ç¬¬${i+1}æ¬¡æäº¤å¤±è´¥`);
                    }
                    
                    // çŸ­æš‚å»¶è¿Ÿï¼Œé¿å…æäº¤å¤ªå¿«
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                addResult('ğŸ¯ å¤šæ¬¡æäº¤å®Œæˆï¼ç°åœ¨åŠ è½½æ’è¡Œæ¦œæŸ¥çœ‹å»é‡æ•ˆæœ...');
                updateStatus('å¤šæ¬¡æäº¤æµ‹è¯•å®Œæˆï¼', 'success');
                
                // è‡ªåŠ¨åŠ è½½æ’è¡Œæ¦œæŸ¥çœ‹æ•ˆæœ
                setTimeout(loadLeaderboard, 1000);
                
            } catch (error) {
                addResult(`âŒ å¤šæ¬¡æäº¤æµ‹è¯•å‡ºé”™: ${error.message}`);
                updateStatus('å¤šæ¬¡æäº¤æµ‹è¯•å¤±è´¥', 'error');
            }
        }
        
        async function loadLeaderboard() {
            if (!window.leaderboard) {
                addResult('âŒ æ’è¡Œæ¦œåŠŸèƒ½æœªåˆå§‹åŒ–');
                return;
            }
            
            addResult('ğŸ“Š æ­£åœ¨åŠ è½½æ’è¡Œæ¦œ...');
            
            try {
                const data = await window.leaderboard.getLeaderboard(10);
                
                if (data.length === 0) {
                    document.getElementById('leaderboardContent').innerHTML = 
                        '<div style="text-align: center; color: #666;">æš‚æ— æ’è¡Œæ¦œæ•°æ®</div>';
                    addResult('ğŸ“‹ æ’è¡Œæ¦œæš‚æ— æ•°æ®');
                } else {
                    let html = '';
                    data.forEach((entry, index) => {
                        const rank = index + 1;
                        const medal = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : `${rank}.`;
                        html += `
                            <div class="rank-item">
                                <span>${medal} ${entry.playerName}</span>
                                <span><strong>${entry.score}</strong> åˆ†</span>
                            </div>
                        `;
                    });
                    document.getElementById('leaderboardContent').innerHTML = html;
                    addResult(`âœ… æˆåŠŸåŠ è½½ ${data.length} æ¡æ’è¡Œæ¦œè®°å½•`);
                    updateStatus(`æ’è¡Œæ¦œåŠ è½½æˆåŠŸï¼Œå…± ${data.length} æ¡è®°å½•`, 'success');
                }
            } catch (error) {
                addResult(`âŒ åŠ è½½é”™è¯¯: ${error.message}`);
                updateStatus('æ’è¡Œæ¦œåŠ è½½å¤±è´¥', 'error');
                document.getElementById('leaderboardContent').innerHTML = 
                    '<div style="color: red;">åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</div>';
            }
        }
        
        function setCustomName() {
            const nameInput = document.getElementById('playerName');
            const newName = nameInput.value.trim();
            
            if (!newName) {
                addResult('âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„æ˜µç§°');
                return;
            }
            
            if (window.leaderboard) {
                const setName = window.leaderboard.setPlayerName(newName);
                addResult(`âœ… æ˜µç§°å·²è®¾ç½®ä¸º: ${setName}`);
                showCurrentPlayer();
                nameInput.value = '';
            } else {
                addResult('âŒ æ’è¡Œæ¦œåŠŸèƒ½æœªåˆå§‹åŒ–');
            }
        }
        
        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const activeEl = document.activeElement;
                if (activeEl.id === 'playerName') {
                    setCustomName();
                }
            }
        });
    </script>
</body>
</html> 